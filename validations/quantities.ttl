@prefix rdf:          <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:         <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd:          <http://www.w3.org/2001/XMLSchema#> .
@prefix sh:           <http://www.w3.org/ns/shacl#> .
@prefix measurements: <http://project-kitchenchef.fr/measurements/data#> .
@prefix :             <http://project-kitchenchef.fr/schema#> .
@prefix s:            <http://project-kitchenchef.fr/contraints/schema#> .
@prefix skos:         <http://www.w3.org/2004/02/skos/core#> .

s:IngredientShape
    a              sh:NodeShape ;
    sh:targetClass :Ingredient ;
    sh:nodeKind    sh:BlankNode ;
    sh:message     "L'ingrédient doit être un noeud anonyme" ;
    sh:property    [ sh:path     :quantity ;
                     sh:minCount 1 ;
                     sh:maxCount 1 ;
                     sh:xone     ( [ sh:datatype     xsd:decimal ;
                                     sh:minExclusive 0 ] [ sh:in ( :Few :Some :Many ) ] ) ;
                     sh:message  "La quantité doit être un décimal supérieur à 0, ou une quantitée indéfinie parmi Few Some et Many" ] ;
    sh:property    [ sh:path     ( :unit rdf:type [ sh:oneOrMorePath rdfs:subClassOf ] ) ;
                     sh:hasValue :MeasurementUnit ;
                     sh:minCount 1 ;
                     sh:maxCount 1 ;
                     sh:message  "L'unité doit être une unité de mesure" ] ;
    sh:property    [ sh:path       :name ;
                     sh:datatype   rdf:langString ;
                     sh:pattern    "^[a-zA-ZéèàùôîûêâëüöÉÈÀÙÔÎÛÊÂËÜÖ\\-',()! ]+$" ;
                     sh:minLength  3 ;
                     sh:uniqueLang true ;
                     sh:message    "Le nom doit être une chaîne de caractères de plus de 3 caractères, composée de lettres, d'espaces, d'apostrophes, de virgules, de parenthèses, de points d'exclamation et de tirets" ;
                     sh:languageIn ( "fr" "de" "es" "it" "en" ) ;
                     sh:minCount   1 ] ;
    sh:property    [ sh:path     :quantityFromUnit ;
                     sh:maxCount 0 ;
                     sh:message  "Cette relation ne devrait pas exister après les prétraitements" ;
                     sh:severity sh:Warning ] .

s:UnitConversionShapeTargets
    a                  sh:NodeShape ;
    sh:targetObjectsOf :hasUnitConversion ;
    sh:nodeKind        sh:BlankNode ;
    sh:property        [ sh:path     ( :unit rdf:type [ sh:zeroOrMorePath rdfs:subClassOf ] ) ;
                         sh:hasValue :MeasurementUnit ;
                         sh:minCount 1 ;
                         sh:maxCount 1 ;
                         sh:message  "La conversion doit désigner une unité de mesure" ] ;
    sh:property        [ sh:path         :conversionRatio ;
                         sh:datatype     xsd:decimal ;
                         sh:minCount     1 ;
                         sh:maxCount     1 ;
                         sh:minExclusive 0 ;
                         sh:message      "La quantité doit être un décimal supérieur à 0" ] ;
    sh:message         "La conversion doit être un noeud anonyme" .

s:UnitConversionShapeSubjects
    a                   sh:NodeShape ;
    sh:targetSubjectsOf :hasUnitConversion ;
    sh:nodeKind         sh:IRI ;
    sh:pattern "http://project-kitchenchef.fr/measurements/data#.*";
    sh:property        [ sh:path     rdf:type  ;
                          sh:minCount 2 ;
                         sh:hasValue skos:Concept].